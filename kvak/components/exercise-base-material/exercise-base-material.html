{% load wagtailcore_tags kvak_extras %}

{% with base_material=base_material_page %}
<div>
  <div class="container">
    <div class="exercise-base-material-component" data-id="{{ base_material.id }}">
      <h2>{{ base_material.title }}</h2>
      <div class="description rich-text">{{ base_material.text|richtext }}</div>
      {% if base_material.video_url %}
      <div class="video-container ratio-16x9">
        <iframe
        src="{{ base_material.video_url }}"
        frameborder="0"
        allowfullscreen
        ></iframe>
      </div>
      {% endif %}
      {% csrf_token %}
      {% for question in base_material.questions %}
      {% get_user_answered_question base_material question as answered_question %}
      <hr />
      <div class="question {% if answered_question %}answered{% endif %}" data-question-id="{{ question.id }}">
        <div class="question-number">
          <div class="icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 30 21"
            >
              <path
                fill="#000"
                d="M9.7132 4.3483c-2.0006 0-3.7552 1.4104-3.7552 3.0182 0 .6798.4993 1.1544 1.2143 1.1544.8298 0 1.0836-.5451 1.3077-1.0268.2392-.5133.4454-.9577 1.3226-.9577.7777 0 1.2057.3752 1.2057 1.0554 0 .5844-.5224.9875-1.1272 1.4538-.705.543-1.5035 1.1596-1.5035 2.2136 0 .604.4204 1.2447 1.1994 1.2447.8711 0 1.0673-.5171 1.2254-.9328.0594-.1571.1155-.3052.2031-.4333.1211-.1783.4255-.3941.7468-.6232.8507-.6057 2.0154-1.4355 2.0154-2.9228.0006-2.3943-2.1841-3.2435-4.0544-3.2435zm-.0754 8.6579c-.8104 0-1.4698.6594-1.4698 1.4696 0 .8107.6593 1.4701 1.4698 1.4701.8107 0 1.4701-.6593 1.4701-1.4701 0-.8102-.6593-1.4696-1.47-1.4696m9.5489-1.4366c-.499 0-.9046.4056-.9046.9046s.4056.9048.9046.9048c.4985 0 .9041-.4058.9041-.9048.0003-.499-.4053-.9046-.9041-.9046m3.3944.905a.905.905 0 1 1-1.8095-.0003.905.905 0 0 1 1.8095.0003m1.5844-.905c-.4985 0-.9049.4056-.9049.9046s.4061.9048.9049.9048c.4985 0 .9046-.4058.9046-.9048-.0003-.499-.4061-.9046-.9046-.9046"
              />
              <path
                fill="#000"
                d="M28.6593 16.0382c1.6994-3.2116 1.0443-7.1111-1.6099-9.5146-1.4222-1.2882-3.271-1.9977-5.2048-1.9977-.986 0-1.9565.1825-2.8835.5425-.0088.0033-.0181.0076-.0275.0113a10.53 10.53 0 0 0-1.216-1.6354C15.7359 1.2552 12.9234 0 10.0006 0c-2.502 0-4.8931.9177-6.7327 2.584-3.4203 3.0977-4.262 8.3086-2.0197 12.4271l-.9085 3.044a.954.954 0 0 0 .2062.9089c.2206.2439.5638.3577.884.2951l3.1054-.601c1.7216 1.1833 3.8062 1.8344 5.8805 1.8344 2.1489 0 4.1953-.6657 5.9192-1.9243l.1281-.0936c1.4039 1.2148 3.1968 1.883 5.0714 1.883 1.5668 0 3.1459-.4822 4.4587-1.3599l2.2294.4321a.95.95 0 0 0 .8839-.2948.953.953 0 0 0 .2067-.9092zm-18.2441 2.5547c-1.8183 0-3.6255-.6052-5.089-1.7042-.2123-.1591-.496-.223-.7506-.1729l-1.9683.3809.5765-1.9316a.95.95 0 0 0-.095-.7593c-2.0465-3.4186-1.435-7.7982 1.4538-10.4144C6.0326 2.642 7.971 1.899 10.0012 1.899c2.3868 0 4.6867 1.028 6.3089 2.8198.3545.3907.6712.8148.9482 1.2629-.5033.3505-.9653.7523-1.3732 1.203-2.4704 2.7284-2.7951 6.734-.7898 9.7414.0289.0433.0602.0851.0901.1281l-.031.0222c-1.3837.9927-3.0227 1.5166-4.7393 1.5166zm16.3098-2.3976.3198 1.0716-1.089-.2113c-.2583-.0498-.5382.0139-.7507.173-1.0554.7931-2.3589 1.2291-3.6705 1.2291-1.4613 0-2.8566-.5345-3.9287-1.5055a6 6 0 0 1-.155-.1473 5.8 5.8 0 0 1-.8644-1.0708c-1.4157-2.2601-1.1246-5.2519.707-7.2748a6.24 6.24 0 0 1 1.1743-1.0079 6.23 6.23 0 0 1 1.2334-.6326c.6932-.2614 1.4145-.3938 2.1444-.3938 1.4618 0 2.8576.535 3.9303 1.5063 2.0809 1.884 2.5205 5.0402 1.0449 7.5043a.95.95 0 0 0-.0957.7598z"
              />
            </svg>
          </div>
          <div class="text">Question {{ forloop.counter }}</div>
        </div>
        <div class="question-text">
          {{ question.value.question_text|richtext }}
        </div>
        <div class="answers" data-question-type="{{ question.block_type }}">
          {% if question.block_type == "multiple_choice_question" %}
            {% for answer_option in question.value.answer_options %}
            <label class="answer-option {% if answer_option.is_correct %}correct{% endif %}">
              <input type="checkbox" name="{{ question.id }}" value="{{ answer_option.option_text }}" {% if answered_question and answered_question.answer_data and answer_option.option_text in answered_question.answer_data %}checked{% endif %} />
              <div class="icon">
                {% if answer_option.is_correct %}
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 22 18">
                  <path fill="#c1e961" stroke="#000" d="M17.5059 1.002c.6232-.6271 1.6121-.6667 2.2812-.1182l.1299.1181 1.084 1.0928h.001c.3201.322.4979.754.498 1.209a1.71 1.71 0 0 1-.4971 1.208l-.0009.002L8.5898 16.998c-.6649.669-1.7461.669-2.411 0L.997 11.7861c-.6632-.6672-.663-1.7496 0-2.417l.3974-.3994.6885-.6924a1.694 1.694 0 0 1 1.206-.502c.399 0 .7771.1375 1.0801.3868l.125.1143.001.001 2.8887 2.9062z"/>
                </svg>
                {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 19 19">
                  <path fill="#ff6224" stroke="#000" d="M4.0713.5154c.5894.0367 1.18.298 1.6426.7617h.001l3.786 3.7861 3.7872-3.7861c.8974-.8972 2.3468-1.077 3.2392-.1836l1.3887 1.3887c.8916.8917.7149 2.34-.1836 3.2373l-3.7871 3.788 3.7871 3.7872c.843.8414 1.0505 2.1683.3389 3.0664l-.1553.1738-1.3887 1.3867c-.8359.8359-2.1617.7335-3.0644-.0215l-.1748-.1601-3.7871-3.7881L5.7148 17.74h-.001c-.8978.8969-2.3454 1.0729-3.2382.1826l-1.3877-1.3877v-.001c-.8927-.8933-.7139-2.3428.1826-3.2392l3.7861-3.7871-3.786-3.7871C.3738 4.8236.195 3.3734 1.0888 2.4812l1.3857-1.3877h.001c.3856-.3848.8874-.573 1.3994-.585l.1846-.0039z"/>
                </svg>
                {% endif %}
              </div>
              <span>{{ answer_option.option_text }}</span>
            </label>
            {% endfor %}
          {% elif question.block_type == "one_correct_answer_question" %}
            {% for answer_option in question.value.answer_options %}
            <label class="answer-option {% if answer_option.is_correct %}correct{% endif %}">
              <input type="radio" name="{{ question.id }}" value="{{ answer_option.option_text }}" {% if answered_question and answered_question.answer_data == answer_option.option_text %}checked{% endif %} />
              <div class="icon">
                {% if answer_option.is_correct %}
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 22 18">
                  <path fill="#c1e961" stroke="#000" d="M17.5059 1.002c.6232-.6271 1.6121-.6667 2.2812-.1182l.1299.1181 1.084 1.0928h.001c.3201.322.4979.754.498 1.209a1.71 1.71 0 0 1-.4971 1.208l-.0009.002L8.5898 16.998c-.6649.669-1.7461.669-2.411 0L.997 11.7861c-.6632-.6672-.663-1.7496 0-2.417l.3974-.3994.6885-.6924a1.694 1.694 0 0 1 1.206-.502c.399 0 .7771.1375 1.0801.3868l.125.1143.001.001 2.8887 2.9062z"/>
                </svg>
                {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 19 19">
                  <path fill="#ff6224" stroke="#000" d="M4.0713.5154c.5894.0367 1.18.298 1.6426.7617h.001l3.786 3.7861 3.7872-3.7861c.8974-.8972 2.3468-1.077 3.2392-.1836l1.3887 1.3887c.8916.8917.7149 2.34-.1836 3.2373l-3.7871 3.788 3.7871 3.7872c.843.8414 1.0505 2.1683.3389 3.0664l-.1553.1738-1.3887 1.3867c-.8359.8359-2.1617.7335-3.0644-.0215l-.1748-.1601-3.7871-3.7881L5.7148 17.74h-.001c-.8978.8969-2.3454 1.0729-3.2382.1826l-1.3877-1.3877v-.001c-.8927-.8933-.7139-2.3428.1826-3.2392l3.7861-3.7871-3.786-3.7871C.3738 4.8236.195 3.3734 1.0888 2.4812l1.3857-1.3877h.001c.3856-.3848.8874-.573 1.3994-.585l.1846-.0039z"/>
                </svg>
                {% endif %}
              </div>
              <span>{{ answer_option.option_text }}</span>
            </label>
            {% endfor %}
          {% elif question.block_type == "text_answer_question" %}
          <textarea name="{{ question.id }}" rows="5">{% if answered_question %}{{ answered_question.answer_data }}{% endif %}</textarea>
          {% elif question.block_type == "order_by_priority_question" %}
            {% for priority_option in question.value.priority_options|randomize_with_original_index %}
            <div class="priority-option" data-order="{{ priority_option.original_index }}">
              <span class="handle">⋮⋮</span>
              <span class="option-text">{{ priority_option.value.option_text }}</span>
            </div>
            {% endfor %}
          {% else %}
            {{ question.block_type }}
          {% endif %}
        </div>
        <div class="answer-submit {% if answered_question %}hidden{% endif %}">
          {% component "arrow-button" type="button" primary=True text="Submit" disabled=True / %}
        </div>
        <div class="explanation-text {% if not answered_question %}hidden{% endif %}">
          <hr>
          <div class="title">Explanation</div>
          {{ question.value.explanation_text|richtext }}
        </div>
      </div>
      {% endfor %}
      <div class="page-buttons">
        {% if base_material_previous_page_index %}
        <div class="previous-page-button">
          {% component "arrow-button" type="link" reverse=True text="Previous page" href="?page={{ base_material_previous_page_index }}" / %}
        </div>
        {% endif %}
        {% if base_material_next_page_index %}
        <div class="next-page-button">
          {% component "arrow-button" type="link" primary=True text="Next page" href="?page={{ base_material_next_page_index }}" disabled=True / %}
        </div>
        {% elif finish_exercise_url %}
        <div class="next-page-button">
          {% component "arrow-button" type="link" primary=True text="Finish exercise" href="{{ finish_exercise_url }}" disabled=True / %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endwith %}
